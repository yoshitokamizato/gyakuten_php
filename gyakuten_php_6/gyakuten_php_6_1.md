---
title: "gyakuten_php_6_1"
tags: ""
---
## オブジェクト指向

オブジェクト指向とは、設計図から物を生み出すという考え方のことです。なぜこのような考え方をプログラミングに取り入れるのかというと、単純に開発効率が上がるからです。

今後のプログラミング学習をスムーズにするためにも知っておいたほうがいいので、以下に書いてあることだけでも理解できるようにしておきましょう。

（実際の現場でのアプリケーション開発ではオブジェクト指向は必須の考え方です）

プログラムの世界では、設計図のことを`クラス` 、設計図から生み出された物のことを`インスタンス`（または`オブジェクト`） といいます。

|     現実の世界    |    プログラムの世界    |
| :----------: | :------------: |
|      設計図     |       クラス      |
| 設計図から生み出された物 | インスタンス（オブジェクト） |

本講座では混乱を避けるため、以降から「`インスタンス`」で話を進めていきます。

### オブジェクト指向を取り入れるメリット

オブジェクト指向を取り入れるメリットは、以下の点にあります。

-   設計図（クラス）を使いまわすことができる（コードを沢山書かなくて済む）
-   物（インスタンス）の質を一定に保つことができる（エラーの発生率を下げることができる）
-   物（インスタンス）のカスタマイズがしやすい（コードを書き換える量が少なくて済む）

これらのメリットにより、コードを書く量を大幅に減らすことができ、開発を効率よく進めることができます。

例えば車だと、設計図をもとに作りますよね？

だからこそ、同じような車を大量に作ることができたり、「1台だけハンドルが全く違う！」みたいなミスを防ぐことができたり、「今回はボディーの部分だけ前よりかっこいいの作ってみる」なんてことが可能になるわけです。

「設計図をもとに物を作る」という発想には、こんなメリットがあるんですね。それをプログラミングに取り入れたのが、オブジェクト指向です。

それではこれから、オブジェクト指向を理解するために必要な基礎知識を身につけていきましょう。

### クラス

オブジェクト指向の部分でもクラスについては少し触れましたが、ここではより詳しく説明していきます。

クラスとは、私たちの世界でいう設計図にあたります。この設計図があることによって、効率よく開発を進めることができるのです。それでは、「車」を例にしてクラスについて学んでいきましょう。

もし、車を作るときに設計図を無しに作成したらどうなるでしょう？きっと、以下のような問題が発生するのではないでしょうか？

作るのに時間がかかる
品質にばらつきが出る
カスタマイズがしにくい
クラスを利用しなかった場合、上記のような問題がプログラミングでも起こりうるわけです。これだと、開発効率も上がらないし、エラーが頻発するプログラムになってしまいます。それらの問題を防ぐために、オブジェクト指向を取り入れるわけです。

せっかくなので、車を例にコードを書いていきましょう。車には、値段や車体の色、乗車人数といった情報があります。それを、クラスを使わずに定義した場合は以下のようになります。

```php
//値段
$car_price = 1000000;
//車体の色
$car_color = red;
//乗車人数
$car_capacity = 4;
```

1台の情報を表すだけなら大して問題はないかもしれません。ですが、これが10台となったらどうでしょう？

```php
$car_price1 = 1000021;
$car_color1 = "red";
$car_capacity1 = 4;
$car_price2 = 1002000;
$car_color2 = "blue";
$car_capacity2 = 20;
$car_price3 = 3000000;
$car_color3 = "green";
$car_capacity3 = 6;
$car_price4 = 1500000;
$car_color4 = "yellow";
$car_capacity4 = 8;
$car_price5 = 8000000;
$car_color5 = "red";
$car_capacity5 = 6;
$car_price6 = 4000000;
$car_color6 = "dark";
$car_capacity6 = 4;
$car_price7 = 1030000;
$car_color7 = "white";
$car_capacity7 = 2;
$car_price8 = 1000930;
$car_color8 = "green";
$car_capacity8 = 4;
$car_price9 = 5000000;
$car_color9 = "yellow";
$car_capacity9 = 40;
$car_price10 = 3000000;
$car_color10 = "red";
$car_capacity10 = 8;
```

10台の車に対する値段・色・乗車人数のたった3つの情報を表すだけでもこれだけの変数（30個）が必要になります。

これがもし、50台も100代も生み出すことになったら、、、、。

スケールがどんどん大きくなるにつれ、クラスを使用しないとめんどくさいことが起こるようになります。コードの記述量が増え、開発にかける労力が大きくなり、エラーが発生する確率も高まり、管理も難しくなる。

コードの見通しも悪くなり、後々変更したいときにどう変更したらいいかわからない。そうなってしまっては、運用保守を行うプログラマーは地獄を見ますね。

それに対し、クラスを利用すると以下のようにすっきりとまとめることができます。これが、クラスを利用するメリット。

```php
<?php
    
//クラス：車の設計図
class Car {
    
    private $price;
    private $color;
    private $capacity;
    
    public function __constract($price, $color, $capacity) {
        $this->price = $price;
        $this->color = $color;
        $this->capacity = $capacity;
    }
}


//設計図から生み出された車
$car1 = new Car(1000021, "red", 4);
$car2 = new Car(1002000, "blue", 20);
$car3 = new Car(3000000, "green", 6);
$car4 = new Car(1500000, "yellow", 8);
$car5 = new Car(8000000, "red", 6);
$car6 = new Car(4000000, "dark", 4);
$car7 = new Car(1030000, "white", 2);
$car8 = new Car(1000930, "green", 4);
$car9 = new Car(5000000, "yellow", 40);
$car10 = new Car(3000000, "red", 8);
    
?>
```

見慣れないコードがたくさん出てきて混乱するかもしれませんが、とにかく今は変数の数が `car1~10`までと3分の1になったことに注目してください。

これらの変数の中に、値段・色・乗車人数など、車を構成する上で必要な情報がまとめて入っています。そうすることで、様々な情報の管理が楽になるわけです。

それでは、クラスの定義の仕方からすこしづつ学んでいきましょう。

### クラスの構成要素

クラスの構成要素は以下のようになっています。

| 構成要素          | 用途           |
| :------------ | :----------- |
| プロパティ         | クラスが持つ情報     |
| メソッド          | クラスが持つ機能     |
| constractメソッド | プロパティの初期値の設定 |

それぞれの構成要素に関しては、このあと詳しく説明します。今は以上のような構成要素でクラスが成り立っていることを理解しておいてください。

### クラスの定義とインスタンス化

では早速、クラスの定義をしてみましょう。クラスを定義するときは`class クラス名 {`で始まり`}`で終わります。クラス名は頭文字を大文字にしてください。それでは、`Car`クラスを定義してみましょう。

```php
<?php
    
//クラスを定義
class Car {

}

?>
```

クラスが定義できたら、次はそのクラスからインスタンスを生み出します。このことをインスタンス化と言います。

`Car`クラスをインスタンス化するときは以下のように記述します。

```php
<?php
class Car{

}

//クラスをインスタンス化
$car = new Car;

?>
```

上記のように、まずはクラスを定義し、そのクラスをインスタンス化することによって、実際にプログラムの中でクラスの持つ情報や機能を活用できるようになります。

クラスが定義できたら、次はその中にクラスの情報を保持する変数を定義する方法を学んでいきましょう。

### インスタンス変数（プロパティ）

インスタンス変数（プロパティ）は、クラスから作成されたインスタンスごとに独立して持つことができる変数です。この変数を利用することで、`car1`では`color`が`red`、`car2`では`color`が`green` 、という風にインスタンスごとに保持する情報を変えることができます。

プロパティという呼び方の方が一般的なのでここではプロパティで進めいきます。

プロパティは、以下のように表します。

```php
<?php
    
class Car {
  //インスタンス変数
  private $color;
}

?>
```

上の記述で「`Car`というクラス（設計図）には`$color`というプロパティを持つ」ことができます。

ここで、`private`という文字が出てきましたが、PHPでオブジェクト指向でプログラムを書く時には`プロパティ`や後述する`メソッド`にアクセス権というものを設定する必要があります。

PHPで使用されるアクセス権は以下の通りです。

| キーワード     | アクセスできる範囲                             |
| :-------- | :------------------------------------ |
| private   | そのクラス自身からのみ可能                         |
| protected | そのクラス自身、そのクラスの親クラス、そのクラスを継承した孫クラスから可能 |
| public    | どのクラスからでも可能                           |

`継承`とか`親クラス`とか`孫クラス`とかそもそも`アクセス`とかちょっとよくわかりませんよね。

`アクセス権`のことを深く理解するためには`クラスの継承`という手法について知る必要があるのですが、今回の講座ではここまで触れませんので、ひとまず、PHPにはアクセス権が3つある、ということだけ頭の片隅に入れておいてください。

### メソッド

定義したインスタンス変数に値を代入したい場合は、以下のようなメソッドを定義します。

メソッドとは「一連の処理のかたまり」であり、前述した通り「クラスの機能」を定義するために使用されるものです。

```php
<?php

class Car {
    private $color;
    //$colorに値を代入（変数に値を設定するのでセッターと呼ばれている）
    public function setColor($color) {
        $this->color = $color;
    }
}

?>
```

定義したメソッド（セッター）を利用する場合は、以下のようなコードを書きます。セッターは`set（プロパティ名）`で命名することが多いです。

```php
<?php

class Car {
    private $color;
    //$colorに値を代入（変数に値を設定するのでセッターと呼ばれている）
    public function setColor($color) {
        $this->color = $color;
    }
}

$car = new Car;

//Carクラスの$colorにセッターを利用してredを代入
$car->setColor("red");
?>
```

ここでもまた難しい書き方が出てきましたね...

まず、メソッドは`public`というアクセス権をを設定しています。クラスに定義されたメソッドには`public`が使われることが多です。

こちらの行について「？」となっている方がいらっしゃるかもしれません。

    $this->color = $color;

この記述の`->color`でクラスの`$color`プロパティを参照（取得）しています。

`$this`はそのクラスから作成されたインスタンス（オブジェクト）自身を指します。

ですので`setColor`メソッドは`Car`クラス（設計図）から作成したインスタンス（物体：車）の`color`というプロパティ（色）に引数に設定した`$color`を当てはめているわけです。

    $car->getColor();

こちらに関してですが、インスタンスからプロパティやメソッドを呼び出すときは、`（インスタンス）名->プロパティ`や`（インスタンス）名->メソッド`と記述します。

難しいですよね。初めて見た時は理解するのが難しいと思うので実際に使うながら理解していくのが良いです。

また、`$color`に代入した`red`を表示するためには、以下のようなメソッドを定義します。表示するメソッドはゲッターと呼ばれます。セッター同様、`get（インスタンス名）`で命名することが多いです。

```php
<?php

class Car {
    private $color;
    //$colorに値を代入（変数に値を設定するのでセッターと呼ばれている）
    public function setColor($color) {
        $this->color = $color;
    }
    
    public function getColor() {
        return $this->color;
    }
}

$car = new Car;
$car->setColor("red");

//Carクラスの$colorに格納されたredを取得して出力
echo $car->getColor();

?>
```

### constractメソッド

constractメソッドは、通常のメソッドとは異なり、クラスがインスタンス化された（インスタンスが作成された）時に実行されるという特徴を持っています。

constractメソッドのことをコンストラクタと呼んだりもします。

そのため、クラスの持つ情報（プロパティ）の初期値を設定する時に利用されます。

```php
<?php

class Car {
    private $color;
    
    //constractメソッドで初期値を設定
    public function __constract() {
        $this->color = "red";
    }
    
    public function setColor($color) {
        $this->color = $color;
    }
    
    public function getColor() {
        return $this->color;
    }
}

//インスタンス化された瞬間にconstractソッドが呼び出され
//$colorにredが代入される
$car = new Car;

//$colorに代入する記述がいらなくなる
//$car->setColor("red");

//$colorを呼び出すとredが表示される
echo $car->getColor();

?>
```

`constract`メソッドを定義する時は`__constract`のように先頭にアンダーバーを2つつけます。（これは決まりなので暗記でOKです）

これで、わざわざインスタンス化した後にセッター（setColorメソッド）で`$color`に値を代入しなくても`red`が代入されるようになりました。

ただ、今のままだと`$color`には`red`しか代入されないようになっています。インスタンスによって`green`や`blue`など、柔軟にプロパティの値を変えるにはどうすればいいでしょう？

実は、インスタンス化をする際、`constract`メソッドには引数を渡すことができます。それにより、インスタンスごとに`color` プロパティの値を変更することが可能になるのです。

```php
<?php

class Car {
    private $color;
    
    //constractメソッドで引数を受け取れるようにする
    public function __constract($color) {
        $this->color = $color;
    }
    
    public function setColor($color) {
        $this->color = $color;
    }
    
    public function getColor() {
        return $this->color;
    }
}

//インスタンス化する際にconstractソッドに値を渡す
$car1 = new Car("red");
$car2 = new Car("green");
$car3 = new Car("blue");

//$colorを呼び出すとインスタンス化した際に代入した値が表示される
echo $car1->getColor();
echo $car2->getColor();
echo $car3->getColor();

?>
```

実行結果

    red
    green
    blue

ここまでは`constract`メソッドに`$color`というプロパティのみを記述し、`car1`〜`car3`というインスタンスにそれぞれの色情報を持たせてきました。ですが、実際の車には色の他にも様々なプロパティが存在します。ですので、ここでは値段（`price`）、店員（`capacity`）も追加で設定し、インスタンス化した時点で３つの情報を持つようにしたいと思います。

そのためには以下のように記載します。（プロパティを表示するだけであればセッターは不要なので削除しておきます）

```php
<?php

class Car {
    //プロパティを追加で定義
    private $color;
    private $price;
    private $capacity;
    
    //constractメソッドにも引数を追加
    public function __constract($color, $price, $capacity) {
        $this->color = $color;
        $this->price = $price;
        $this->capacity = $capacity;
    }
    
    
    public function getColor() {
        return $this->color;
    }
    
    public function getPrice() {
        return $this->price;
    }
    
    public function getCapacity() {
        return $this->capacity;
    }
}

//インスタンス化する際にconstractソッドに値を渡す
$car1 = new Car("red", 1000000, 4);
$car2 = new Car("green", 1500000, 5);
$car3 = new Car("blue", 3000000, 8);


echo $car1->getColor();
echo $car2->getColor();
echo $car3->getColor();

echo $car1->getPrice();
echo $car2->getPrice();
echo $car3->getPrice();

echo $car1->getCapacity();
echo $car2->getCapacity();
echo $car3->getCapacity();

?>
```

実行結果

    red
    1000000
    4
    green
    1500000
    5
    blue
    3000000
    8

このようにオブジェクト指向に沿ってコードを書くと、

-   car1
-   car2
-   car3

のそれぞれが`color`、`price`、`capacity`のプロパティを最初から保持するようになり、わざわざそれぞれの変数を0から定義する必要がなくなります。

それに`constract`メソッドで引数を受け取ることによって、このクラスのインスタンスは、`new`演算子を使用してインスタンス化する際に

「`color`、`price`、`capacity`の3つの情報を保持してなければいけない」

といったルールを設定することもできるようになります。その結果、「必要な情報が足りない！」なんて人為的なミスも防ぐことができるのです。

### まとめ

オブジェクト指向は、効率よくコードを書くためにもとても大切な概念です。

今はまだ「なんとなく」くらいでしかオブジェクト指向のメリットを体感することができないかもしれません。

ですが、プログラミングを学ぶに連れ、どんどんオブジェクト指向のメリットがわかって楽しくなるので、ぜひなんども復習を繰り返しながら学習を進めていってください。

今回はこれで以上となります。

お疲れ様でした！
